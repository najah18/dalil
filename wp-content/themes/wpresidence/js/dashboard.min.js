function wpestate_process_inaction(a){var e;window.scrollTo(0,0),e='<div class="modal fade" id="loadingmodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-body listing-submit"><span>'+a+"</div></div></div></div></div>",jQuery("body").append(e),jQuery("#loadingmodal").modal()}function wpestate_chart_total_listings_widget(a,e,t){if(document.getElementById("myChart_widget_total")){var i=jQuery("#myChart_widget_total").get(0).getContext("2d"),s=(new Chart(i),"  ");s=a;var l={labels:e,datasets:[{label:t,fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:s}]},r={title:"page views",scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};new Chart(i,{type:"bar",data:l,options:r})}}function wpestate_chart_total_listings_widget2(a,e,t){if(document.getElementById("myChart_widget_total")){var i=document.getElementById("myChart_widget_total").get(0).getContext("2d"),s=(new Chart(i),{labels:e,datasets:[{label:t,fillColor:"rgba(108, 93, 211, 0.85)",strokeColor:"rgba(108, 93, 211, 0.85)",highlightFill:"rgba(108, 93, 211, 0.85)",highlightStroke:"rgba(220,220,220,1)",data:a}]}),l={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};new Chart(i,{type:"bar",data:s,options:l})}}function wpestate_dash_set_upload_plans(){jQuery(".aaiu-uploader-floor-plans").each(function(a){var e=jQuery(this).attr("id");wpestate_floorPlanImage(e)});jQuery(".wpestate_dash_delete_plan").click(function(a){jQuery(this).parents(".floor_plan_unit_wrapper").remove()})}function wpestate_dash_add_new_plan(){jQuery("#add_new_floor_plan").click(function(a){a.preventDefault();var e=jQuery(".floor_plan_unit_wrapper").length;e=parseInt(e)+1;var t='<div class="floor_plan_unit_wrapper row"><div id="#aaiu-upload-imagelist-floor-plant"></div><div class="col-md-12"><label for="plan_title">'+wpestate_dashboard_js_vars.plan_title+'</label><a class="wpestate_dash_delete_plan" onclick="return confirm('+wpestate_dashboard_js_vars.are_you_sure+');">'+wpestate_dashboard_js_vars.delete_plan+'</a><input id="plan_title" type="text" size="36" name="plan_title[]" value="" ></div><div class="col-md-12"><label for="plan_description">'+wpestate_dashboard_js_vars.plan_description+'</label><textarea class="plan_description" type="text" size="36" name="plan_description[]" ></textarea></div><div class="col-md-6"><label for="plan_size">'+wpestate_dashboard_js_vars.plan_size+'</label><input id="plan_size" type="text" size="36" name="plan_size[]" value=""></div><div class="col-md-6"><label for="plan_rooms">'+wpestate_dashboard_js_vars.plan_rooms+'</label><input id="plan_rooms" type="text" size="36" name="plan_rooms[]" value=""></div><div class="col-md-6"><label for="plan_bath">'+wpestate_dashboard_js_vars.plan_bath+'</label><input id="plan_bath" type="text" size="36"name="plan_bath[]" value=""></div><div class="col-md-6"><label for="plan_price">'+wpestate_dashboard_js_vars.plan_price+'</label><input id="plan_price" type="text" size="36" name="plan_price[]" value=""></div><div class="col-md-6"><div id="upload-container"><div id="aaiu-upload-container"><div class="aaiu-upload-imagelist-floor-plan"></div><div id="imagelist"><img src="" class="floor_plan_image_thumb"><input class="floor_plan_image" type="hidden" size="36" name="floor_plan_image[]" value=""><input type="hidden" class="plan_image_attach" name="plan_image_attach[]" value=""></div><div id="aaiu-uploader-floor-plans-'+e+'"  class=" aaiu-uploader-floor-plans wpresidence_button wpresidence_success">'+wpestate_dashboard_js_vars.uploadnew+"</div></div></div></div></div>";jQuery(".section_floor_plan_unit_wrapper").append(t);var i="aaiu-uploader-floor-plans-"+e;wpestate_floorPlanImage(i),jQuery(".wpestate_dash_delete_plan").click(function(a){jQuery(this).parents(".floor_plan_unit_wrapper").remove()})})}function wpestate_floorPlanImage(a){var e=jQuery("#"+a).parents(".floor_plan_unit_wrapper"),t=new plupload.Uploader({runtimes:"html5,flash,html4",browse_button:a,file_data_name:"aaiu_upload_file",url:wpestate_dashboard_js_vars.ajaxurl+"?action=wpestate_me_upload",multi_selection:!1,filters:{mime_types:[{title:wpestate_dashboard_js_vars.allow_file_type,extensions:"jpg,jpeg,gif,pdf,png"}],max_file_size:"12000kb",prevent_duplicates:!0}});t.init(),jQuery("#"+a).on("click",function(a){a.preventDefault(),t.splice(),t.refresh()}),t.bind("FilesAdded",function(a,i){a.files.length>1?a.splice(1):(plupload.each(i,function(a){}),jQuery.each(i,function(a,t){e.find(".aaiu-upload-imagelist-floor-plan").append('<div id="'+t.id+'" class="floorplan_upload_notification">Uploading '+t.name+" ("+plupload.formatSize(t.size)+") <b></b></div>")}),a.refresh(),t.start())}),t.bind("UploadProgress",function(a,e){jQuery("#"+e.id+" b").html(e.percent+"%")}),t.bind("Error",function(a,e){jQuery("#aaiu-upload-imagelist-floor-plant").append("<div>Error: "+e.code+", Message: "+e.message+(e.file?", File: "+e.file.name:"")+"</div>"),a.refresh()}),t.bind("FileUploaded",function(a,t,i){i=jQuery.parseJSON(i.response);i.success?(e.find(".floor_plan_image").val(i.html),e.find(".floor_plan_image_thumb").attr("src",i.html),e.find(".plan_image_attach").val(i.attach),e.find(".floorplan_upload_notification").remove()):(e.find(".floor_plan_image_thumb").attr("src",""),e.find(".plan_image_attach").val(""))})}function wpestate_filter_invoices(){"use strict";var a=jQuery("#invoice_start_date").val(),e=jQuery("#invoice_end_date").val(),t=jQuery("#invoice_type").val(),i=jQuery("#invoice_status").val(),s=jQuery("#wpestate_invoices_actions").val();jQuery.ajax({type:"POST",url:wpestate_dashboard_js_vars.ajaxurl,dataType:"json",data:{action:"wpestate_ajax_filter_invoices",start_date:a,end_date:e,type:t,status:i,security:s},success:function(a){a.success&&(jQuery(".invoice_unit").remove(),jQuery(".wpestate_dashboard_table_list_header ").after(a.data.results),jQuery("#invoice_confirmed").empty().append(a.data.invoice_confirmed))},error:function(a,e,t){console.log("Error filtering invoices:",t)}})}function wpestate_print_invoice_page(){jQuery(".print_invoice").on("click",function(a){var e,t,i;i=wpestate_dashboard_js_vars.ajaxurl,a.preventDefault(),e=jQuery(this).attr("data-post-id"),t=window.open("","Print Invoice","width=700 ,height=842");var s=jQuery("#wpestate_invoices_actions").val();jQuery.ajax({type:"POST",url:i,data:{action:"wpestate_ajax_create_print_invoice",propid:e,security:s},success:function(a){t.document.write(a),t.document.close(),t.focus(),setTimeout(function(){t.print()},3e3)},error:function(a){}})})}function wpestate_crm_add_comment_dashboard(){const a=jQuery("#crm_insert_comment"),e=jQuery("#crm_new_commnet"),t=jQuery("#show_notes_wrapper");a.on("click",function(i){i.preventDefault();const s=e.val().trim();if(!s)return;const l={action:"wpestate_crm_add_comment_dashboard",item_id:jQuery(this).data("postid"),content:s,security:jQuery("#wpestate_crm_insert_note").val()};a.prop("disabled",!0),e.prop("disabled",!0),a.addClass("loading"),jQuery.ajax({type:"POST",url:wpestate_dashboard_js_vars.ajaxurl,data:l,dataType:"json",success:function(a){if(a.success)t.prepend(a.data.html),e.val("");else{const e=a.data.message||wpestate_dashboard_js_vars.strings.error_adding_comment;console.error("Error adding comment:",e)}},error:function(a,e,t){wpestate_dashboard_js_vars.strings.ajax_error;console.error("AJAX Error:",e,t)},complete:function(){a.prop("disabled",!1),e.prop("disabled",!1),a.removeClass("loading")}})}),e.on("keydown",function(e){(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(a.click(),e.preventDefault())})}jQuery(document).ready(function(a){"use strict";jQuery(".per_listing_payment").click(function(a){a.preventDefault();var e=jQuery(this).attr("data-listingid");jQuery("#paymodal_"+e).show(),wpestate_enable_stripe_booking_prop()}),jQuery(".paymentmodal_close").click(function(a){jQuery(this).parents(".paymentmodal").hide()}),a("#open_packages").on("click",function(e){a(".pack_description_row").slideToggle(),jQuery(this).toggleClass("open_pack_on"),a(".pack-listing:first").find(".buypackage").trigger("click")}),a(".buy_package_sh a").on("click",function(a){0===parseInt(ajaxcalls_vars.userid,10)&&(a.preventDefault(),jQuery("#modal_login_wrapper").show(),jQuery("#modal_login_wrapper").find("[autofocus]").focus(),jQuery(".loginpop").val("1"))}),a("#invoice_start_date, #invoice_end_date, #invoice_type ,#invoice_status ").on("change",function(){wpestate_filter_invoices()}),wpestate_print_invoice_page(),a(".disable_listing").on("click",function(e){e.preventDefault(),e.stopPropagation();var t=a(this).attr("data-postid"),i=wpestate_dashboard_js_vars.ajaxurl,s=0;a(this).text(wpestate_dashboard_js_vars.processing),a(this).hasClass("disabledx")?(s=1,a(this).removeClass("disabledx")):a(this).addClass("disabledx");var l=a(this),r=a(this).parents().eq(4),n=0;if(jQuery(this).hasClass("disable_agent")){var o=jQuery("#wpestate_agent_actions").val();n=1}else o=jQuery("#wpestate_property_actions").val();a.ajax({type:"POST",url:i,data:{action:"wpestate_disable_listing",security:o,prop_id:t,is_agent:n},success:function(a){1===s?(l.empty().append('<i class="fas fa-play"></i>'),r.find(".property_dashboard_status").html(wpestate_dashboard_js_vars.disabled),l.html(wpestate_dashboard_js_vars.disablelisting),jQuery(".page-template-user_dashboard_agent_list").length>0?wpestate_dashboard_js_vars.enableagent:wpestate_dashboard_js_vars.enablelisting):(jQuery(".page-template-user_dashboard_agent_list").length>0?wpestate_dashboard_js_vars.disableagent:wpestate_dashboard_js_vars.disablelisting,r.find(".property_dashboard_status").empty().html(wpestate_dashboard_js_vars.published)),location.reload()},error:function(a){}})}),wpestate_dash_set_upload_plans(),wpestate_dash_add_new_plan(),wpestate_crm_add_comment_dashboard()});